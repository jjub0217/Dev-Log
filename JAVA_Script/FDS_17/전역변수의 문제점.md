# 전역변수의 문제점

<p style="color:red";> 들어가기에 앞서...</p>

> 변수 호이스팅이나 함수 호이스팅은 스코프를 단위로 동작한다.<br>즉, 호이스팅은 변수 선언이 스코프의 선두로 끌어 올려진 것처럼 동작한다.

---

전역 변수의 무분별한 사용은 위험하다. 

1. <u>전역변수의 생명주기가 길기 때문이다.</u>

   변수는 생성되고 값을 할당받고 언젠가 짜부러진다. 이렇듯 전역 변수는 생명주기가 있는데, 언제 소멸되느냐를 말한다면 전역 변수는 윈도우가 살아있으면 그때 소멸이 된다. 즉, 윈도우 창을 닫지 않으면 소멸되지 않는다는건데, 이렇게 생명주기가 길게 되면 메모리도 많이 쓰게 되고, 변수의 상태를 변경할 수 있는 시간도 길고, 전역변수는 모든 함수가 참조할수 있기 때문에 상태를 변경할 기회도 많다. 

   -> 변수의 변경이 많이 될 확률이 높아지면 추적도 어려워진다. 이는 에러 발생의 원인이다.

2. <u>var 키워드로 선언한 전역 변수는 전역 객체의 프로터티가 되기 때문이다.</u>

   전역 변수의 생명 주이가 전역 객체의 생명 주기와 일치한다는 말인데, 이렇게 되면 위에서 언급한것처럼 메모리 소모와 추적의 어려움이 있다. 

3. <u>전역 변수는 어디에서나 참조가 가능하기 때문이다.("암묵적 결합")</u>

   이도 위에서 언급했다. 전역 변수는 코드 어디에서나 참조가 가능한데, 이를 "암묵적 결합"이라고 한다. <br>암묵적 결합이 생기면 변수의 스코프(유효 범위)도 넓어지고, 그렇게 되면 코드의 가독성은 나빠지게 된다.  	함수는 작게 만들어야 한다. 한 함수에서 많은 일을 하게 하지 말고 스코프를 좁게 만들어야 좋다. 

4. <u>전역 변수는 스코프 체인 상에서 종점에 존재하기 때문이다.</u>

   전역 변수는 스코프에서 식별자를 찾을때 가장 마지막에 찾아지는 변수다. 즉, 전역 변수를 스코프 내에서 찾는 속도가 느리다는 것이다. 

5. <u>네임 스페이스가 오염되기 때문이다.</u>

   "네임 스페이스"란, 이름들이(식별자들)이 기억되어지는 공간을 말한다.<br>JS파일을 여러개 만든다 해도 JS는 하나의 전역 스코프를 공유한다. 즉, 파일이 분리되어있다 해도 하나의 전역 스코프를 공유함으로써 이름이 중복될 가능성이 크며, 그로 인해 이름이 충돌될 가능성도 높다. 

   JS에서 var 키워드는 중복 선언이 허용되는 만큼, 이름이 충돌된 가능성이 높아진다는 것이다. 그렇게 되면 예기치 않은 일들이 발생할 가능성도 높아진다. 

-> 그렇기 때문에 지역 변수를 써야 한다. 

### 지역변수를 써야하는 이유는?

1. <u>지역 변수의 생명주기가 전역 변수의 생명 주기보다 짧기 때문이다.</u>

   지역 변수는 함수가 호출되어야 생성이 되고, 소멸은 함수가 종료가 되면 그때 소멸이 된다. 즉, 윈도우창을 닫지 않으면 계속 살아있는 전역 변수들보다는 생명주기가 짧은 것이다. 그렇게 되면 메모리 소모도, 추적의 어려움도 적어진다.

2. <u>지역변수는 함수가 호출되기 이전에는 생성되지 않기 때문이다.</u>

   위에서 언급한것처럼, 지역 변수는 함수가 호출되어야 생성이 된다. 즉, 지역 변수의 생명 주기는 함수의 생명주기와 일치한다. 

   -> 따라서 지역변수는 금새 태어났다가 금새 죽는다. 

3. <u>지역변수는 지역에서만 참조할수 있기 때문이다.</u>

   지역변수는 지역에서만 참조할수 있기 때문에, 변경이 되는 가능성이 적다.<br>그래서 지역변수가 전역변수보다 훨씬 안전하다. ![캡쳐97](https://user-images.githubusercontent.com/62126380/81494616-3b671980-92e5-11ea-9b2d-c2a6f4267eb6.PNG) 

   ​				└> 지역변수의 생명주기는 전역변수의 생명주기보다 짧다. 



## 전역 변수 사용 억제 방법

전역 변수를 반드시 사용해야 하는 이유가 없다면 지역 변수를 사용해야 한다. <br>그러면 이렇게 전역 변수를 자제하고 다른 방법을 쓸수 있는 것들이 뭐가 있을까?

1. <u>즉시 실행 함수을 사용한다.</u>

   즉시 실행 함수는 함수 정의와 동시에 호출되면서, 단 한번만 호출이 된다. 즉, 모든 코드를 즉시 실행 함수로 만든다면 모든 변수는 즉시 실행 함수의 지역 변수가 된다. 이렇게 지역변수로 만드는것이다.

2. <u>전역에 네임 스페이스 객체를 만든다.</u>

   네임 스페이스 객체안에 또 다른 동일한 네임 스페이스 객체를 프로퍼티로 추가하여 구조를 계층적으로 만드는것이다. 이렇게 하면 식별자 충돌은 막을수 있지만 네임 스페이스 객체 자체가 전역 변수에 할당되므로 별로다. 

   -> 전역 변수를 빈 객체로 하나만 만들고 동일한 네임 스페이스 객체를 프로퍼티로 추가

   ```js
   네임 스페이스 객체 안에 동일하지만 다른 네임 스페이스 객체를 프로퍼티로 추가 
   
   ex 1)
   var MYAPP = {};
   MYAPP.name = 'Lee';    // 동일한 네임 스페이스 객체를 프로퍼티로 추가
   console.log(MYAPP.name);
   
   ex 2)
   var MYAPP = {};
   MYAPP.person = {    // 동일한 네임 스페이스 객체를 프로퍼티로 추가
       name: 'Lee',
       address: 'Seoul'
   };
   console.log(MYAPP.person.name);
   ```

3. <u>모듈 패턴</u> <- 이건 클로저를 알아야 한다. 

4. <u>ES6 모듈을 사용한다</u>

   원래 JS에너 모듈을 지원하지 않았는데, ES6 부터 지원하기 시작했다. 하지만 아직 현 단계에서는 불안해서 아직 현업에서 대중적으로 사용하고 있지는 않다.

   script 태구에 type="module" 이란 어트리뷰트를 추가하면 모듈사용을 할수 있다. <br>모듈 파일의 확장자는 "mjs"를 권장한다. 